"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const packets_1 = require("../packets");
const mqtt_utilities_1 = require("../mqtt.utilities");
function incomingPingFlow() {
    return success => ({
        start: () => {
            success();
            return new packets_1.PingResponsePacket();
        },
    });
}
exports.incomingPingFlow = incomingPingFlow;
function incomingPublishFlow(message, identifier = -1) {
    return success => ({
        start: () => {
            let packet = undefined;
            let emit = true;
            if (message.qosLevel === 1) {
                packet = new packets_1.PublishAckPacket();
            }
            else if (message.qosLevel === 2) {
                packet = new packets_1.PublishReceivedPacket();
                emit = false;
            }
            if (packet)
                packet.identifier = identifier;
            if (emit)
                success(message);
            return packet;
        },
        accept: packet => mqtt_utilities_1.isPubRel(packet) && packet.identifier === identifier,
        next: () => {
            success(message);
            const response = new packets_1.PublishCompletePacket();
            response.identifier = identifier;
            return response;
        },
    });
}
exports.incomingPublishFlow = incomingPublishFlow;
//# sourceMappingURL=incoming.flows.js.map